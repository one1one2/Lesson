function [F g] = extend_wood(x, flag, F)

n = length(x);
if nargin == 1
	F = 0;
	g = zeros(n,1);
	for i = 1:n/2-1
		F = F + 100*(x(2*i)-x(2*i-1)^2)^2 + (x(2*i-1)-1)^2 + ...
		90*(x(2*i+2)-x(2*i+1)^2)^2 + (x(2*i+1)-1)^2 + ...
		10*(x(2*i) + x(2*i+2) -2)^2 + (x(2*i)-x(2*i+2))^2/10;
		g(2*i-1) = g(2*i-1) - 200*(x(2*i)-x(2*i-1)^2)*(2*x(2*i-1))...
		-2*(1- x(2*i-1));
		g(2*i) = g(2*i) + 200*(x(2*i)-x(2*i-1)^2)+20*(x(2*i)+x(2*i+2)-2)...
		+ 2*(x(2*i)-x(2*i+2))/10;
		g(2*i+1) = g(2*i+1) - 360*(x(2*i+2)-x(2*i+1)^2)*x(2*i+1) ...
		- 2*(1-x(2*i+1));
		g(2*i+2) = g(2*i+2) + 180*(x(2*i+2)-x(2*i+1)^2)...
		+20*(x(2*i)+x(2*i+2)-2) - 2*(x(2*i)-x(2*i+2))/10;
	end 
end

if nargin == 2
	for i = 1:n/2-1
		F{i} = x(2*i-1:2*i+2);
	end
	if nargout > 1
		for i = 1:n/2-1
	%		g{i}=  [ - 200*(x(2*i)-x(2*i-1)^2)*(2*x(2*i-1))-2*(1- x(2*i-1));
	%	            200*(x(2*i)-x(2*i-1)^2)+20*(x(2*i)+x(2*i+2)-2)+ 2*(x(2*i)-x(2*i+2))/10;
	%	  - 180*(x(2*i+2)-x(2*i+1)^2)*(2*x(2*i+1)) - 2*(1-x(2*i+1));
	%	  180*(x(2*i+2)-x(2*i+1)^2)+20*(x(2*i)+x(2*i+2)-2) - 2*(x(2*i)-x(2*i+2))/10];
			g{i} = [ - 200*(x(2*i)-x(2*i-1)^2)*(2*x(2*i-1))-2*(1- x(2*i-1));
					200*(x(2*i)-x(2*i-1)^2)+20*(x(2*i)+x(2*i+2)-2)+ 2*(x(2*i)-x(2*i+2))/10;
					-360*x(2*i+1)*(x(2*i+2)-x(2*i+1)^2) - 2*(1-x(2*i+1));
					180*(x(2*i+2)-x(2*i+1)^2) + 20*(x(2*i)+x(2*i+2)-2) - 2*(x(2*i)-x(2*i+2))/10];
		end
	end
end

if nargin == 3
	F = zeros(2*n+2,1);
	for i = 1:n
		F(2*i-1:2*i+2) = F(2*i-1:2*i+2) + x{i};
	end
end
	
end
